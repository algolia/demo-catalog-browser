{"version":3,"sources":["widgets/Carousel.js","app.js"],"names":["renderCarousel","isFirstRender","widgetParams","hits","container","document","querySelector","wrapper","createElement","classList","add","appendChild","carouselTitle","textContent","title","carouselListContainer","setAttribute","context","style","width","window","innerWidth","getBoundingClientRect","left","ul","innerHTML","map","hit","index","objectID","length","image","genre","join","customCarousel","instantsearch","connectors","connectHits","searchClient","algoliasearch","search","indexName","referenceHit","color","popularity_score","actors","ongoing_watch","tmdb_id","views_last_7_days","days_to_expire","searchParams","URLSearchParams","location","userToken","get","myCarousels","extraConfig","facetFilters","hitsPerPage","relatedRef","enablePersonalization","addWidgets","carousel","widgets","indexId","configure","ruleContexts","query","EXPERIMENTAL_configureRelatedItems","matchingPatterns","score","start"],"mappings":"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","file":"app.ede2f3da.js","sourceRoot":"../src","sourcesContent":["/**\n * @requires module:instantsearch\n */\n\nconst renderCarousel = ({ widgetParams, hits }, isFirstRender) => {\n  const container = document.querySelector(widgetParams.container);\n\n  if (isFirstRender) {\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('carousel-single');\n\n    container.appendChild(wrapper);\n\n    const carouselTitle = document.createElement('h2');\n    carouselTitle.textContent = widgetParams.title;\n    wrapper.appendChild(carouselTitle);\n\n    const carouselListContainer = document.createElement('ul');\n    carouselListContainer.classList.add('carousels__list-container');\n    carouselListContainer.setAttribute('id', widgetParams.context);\n    wrapper.appendChild(carouselListContainer);\n\n    wrapper.style.width = `${window.innerWidth -\n      wrapper.getBoundingClientRect().left}px`;\n  }\n\n  const ul = container.querySelector(`ul#${widgetParams.context}`);\n  ul.innerHTML = hits\n    .map(\n      (hit, index) => `\n        <li class=\"analytics\" data-object-id=\"${hit.objectID}\" style=\"${\n        index === hits.length - 1\n          ? `padding-right: ${ul.getBoundingClientRect().left + 180}px`\n          : ''\n      }\">\n            <img src=\"${hit.image}\" alt=\"${hit.title}\">\n            <div class=\"overlay\">\n              <h3>${hit.title}</h3>\n              <ul>\n                ${hit.genre\n                  .map(\n                    genre => `\n                  <li>${genre}</li>\n                `\n                  )\n                  .join('')}\n              </ul>\n          </div>\n        </li>\n    `\n    )\n    .join('');\n};\n\nexport const customCarousel = instantsearch.connectors.connectHits(\n  renderCarousel\n);\n","import { customCarousel } from './widgets/Carousel';\n\n/* global algoliasearch instantsearch */\nconst searchClient = algoliasearch(\n  'GENYJWQIK2',\n  '61a10f4c69aee59a993ebc3021574681'\n);\n\nconst search = instantsearch({\n  indexName: 'perso_movies_carousel',\n  searchClient,\n});\n\n// const movies = searchClient.initIndex('perso_movies_carousel');\n\n// movies\n//   .search('', {\n//     filters: 'genre:action AND genre:crime',\n//     hitsPerPage: 100,\n//   })\n//   .then(({ hits }) => {\n//     aa('clickedObjectIDs', {\n//       index: 'perso_movies_carousel',\n//       eventName: 'CLICKED_MOVIE',\n//       userToken: 'action_crime_fan',\n//       objectIDs: hits\n//         .filter(() => Math.floor(Math.random() * 10) < 7)\n//         .slice(43, 61)\n//         .map(hit => hit.objectID),\n//     });\n\n//     aa('viewedObjectIDs', {\n//       index: 'perso_movies_carousel',\n//       eventName: 'VIEWED_MOVIE',\n//       userToken: 'action_crime_fan',\n//       objectIDs: hits.slice(65, 87).map(hit => hit.objectID),\n//     });\n\n//     aa('convertedObjectIDs', {\n//       index: 'perso_movies_carousel',\n//       eventName: 'WATCHED_MOVIE',\n//       userToken: 'action_crime_fan',\n//       objectIDs: hits\n//         .filter(() => Math.floor(Math.random() * 10) < 3)\n//         .slice(1, 19)\n//         .map(hit => hit.objectID),\n//     });\n//   });\n\nconst referenceHit = {\n  title: 'The Imitation Game',\n  image: 'https://image.tmdb.org/t/p/w154/ntZGfHt4d73A9fDD4KUN4nbDQlq.jpg',\n  color: '#192229',\n  popularity_score: 108.4335114104872,\n  actors: ['Benedict Cumberbatch', 'Keira Knightley', 'Matthew Goode'],\n  genre: ['History', 'Drama', 'Thriller', 'War'],\n  ongoing_watch: [],\n  tmdb_id: 205596,\n  views_last_7_days: 596898,\n  days_to_expire: 44,\n  objectID: '439434880',\n};\n\nconst searchParams = new URLSearchParams(window.location.search);\n\nconst userToken = searchParams.get('userToken') || 'alphonse';\n\nconst myCarousels = userToken\n  ? [\n      {\n        title: 'Trending',\n        context: 'trending',\n        indexName: 'perso_movies_carousel_trending',\n      },\n      {\n        title: 'Most Popular',\n        context: 'most-popular',\n        indexName: 'perso_movies_carousel',\n      },\n      {\n        title: 'Last chance',\n        context: 'last-chance',\n        indexName: 'perso_movies_carousel_last_chance',\n      },\n\n      {\n        title: 'Fantasy Comedy',\n        context: 'comedy_fantasy',\n        indexName: 'perso_movies_carousel',\n      },\n      {\n        title: 'You started watching',\n        context: 'ongoing',\n        indexName: 'perso_movies_carousel',\n        extraConfig: {\n          facetFilters: 'ongoing_watch: user_1',\n          hitsPerPage: 5,\n        },\n      },\n      {\n        title: 'Because you watched The Imitation Game',\n        context: 'related',\n        indexName: 'perso_movies_carousel_related',\n        relatedRef: referenceHit,\n      },\n      {\n        title: 'Curated for you',\n        context: 'curated',\n        indexName: 'perso_movies_carousel',\n        extraConfig: {\n          enablePersonalization: true,\n          userToken,\n        },\n      },\n    ]\n  : [\n      {\n        title: 'Trending',\n        context: 'trending',\n        indexName: 'perso_movies_carousel_trending',\n      },\n      {\n        title: 'Most Popular',\n        context: 'most-popular',\n        indexName: 'perso_movies_carousel',\n      },\n      {\n        title: 'Last chance',\n        context: 'last-chance',\n        indexName: 'perso_movies_carousel_last_chance',\n      },\n\n      {\n        title: 'Fantasy Comedy',\n        context: 'comedy_fantasy',\n        indexName: 'perso_movies_carousel',\n      },\n    ];\n\nconst addWidgets = () => {\n  search.addWidgets(\n    myCarousels.map(carousel =>\n      instantsearch.widgets\n        .index({\n          indexName: carousel.indexName,\n          indexId: carousel.context,\n        })\n        .addWidgets(\n          !carousel.relatedRef\n            ? [\n                instantsearch.widgets.configure({\n                  ruleContexts: carousel.context,\n                  hitsPerPage: 15,\n                  query: '',\n                  ...carousel.extraConfig,\n                }),\n                customCarousel({\n                  container: '.carousels',\n                  title: carousel.title,\n                  context: carousel.context,\n                }),\n              ]\n            : [\n                instantsearch.widgets.configure({\n                  ruleContexts: carousel.context,\n                  hitsPerPage: 15,\n                  query: '',\n                  ...carousel.extraConfig,\n                }),\n                instantsearch.widgets.EXPERIMENTAL_configureRelatedItems({\n                  hit: carousel.relatedRef,\n                  matchingPatterns: {\n                    genre: { score: 3 },\n                    actors: { score: 2 },\n                  },\n                }),\n                customCarousel({\n                  container: '.carousels',\n                  title: carousel.title,\n                  context: carousel.context,\n                }),\n              ]\n        )\n    )\n  );\n};\n\naddWidgets();\n\nsearch.start();\n\n// document.querySelector('#user_select').addEventListener('change', e => {\n//   window.location.href = `${window.location.href}?userToken=${e.currentTarget.value}`;\n// });\n\n// document.addEventListener('click', e => {\n//   if (e.target.matches('.analytics')) {\n//     console.log('click', e.target.dataset.objectId);\n\n//     aa('clickedObjectIDs', {\n//       index: 'perso_movies_carousel',\n//       eventName: 'CLICKED_MOVIE',\n//       objectIDs: [e.target.dataset.objectId],\n//     });\n\n//     aa('viewedObjectIDs', {\n//       index: 'perso_movies_carousel',\n//       eventName: 'VIEWED_MOVIE',\n//       objectIDs: [e.target.dataset.objectId],\n//     });\n\n//     if (Math.floor(Math.random() * 10) < 4) {\n//       aa('convertedObjectIDs', {\n//         index: 'perso_movies_carousel',\n//         eventName: 'WATCHED_MOVIE',\n//         objectIDs: [e.target.dataset.objectId],\n//       });\n//     }\n//   }\n// });\n"]}